# ThetaMind 后续开发计划 (Development Roadmap)

**更新日期:** 2025-01-XX  
**当前完成度:** Backend ~85%, Frontend ~75%

---

## 📊 项目整体状态

### ✅ 已完成的核心功能

#### Backend (85%)
- ✅ **认证系统**: Google OAuth2 + JWT，完整的用户管理
- ✅ **市场数据服务**: Tiger API 集成，Redis 缓存，熔断器，重试逻辑
- ✅ **AI 服务**: Gemini 3.0 Pro 集成，报告生成，每日精选，上下文过滤
- ✅ **支付系统**: Lemon Squeezy 完整集成，Webhook 验证，审计日志
- ✅ **策略管理**: CRUD 操作，JSONB 存储
- ✅ **管理员系统**: 系统配置管理，用户管理
- ✅ **调度器**: 每日精选生成（08:30 EST），配额重置（00:00 UTC）
- ✅ **冷启动优化**: 启动时自动检查并生成每日精选
- ✅ **数据标准化**: Mock 数据与真实数据兼容层

#### Frontend (75%)
- ✅ **UI 框架**: MainLayout，响应式设计，主题切换
- ✅ **核心页面**: Dashboard, Strategy Lab, Daily Picks, Pricing, Login
- ✅ **图表组件**: Payoff Chart（带导出功能），Candlestick Chart（未集成）
- ✅ **策略构建器**: 4 腿限制，模板系统，实时计算
- ✅ **AI 分析**: 报告生成，配额检查
- ✅ **管理员界面**: 配置管理，用户管理

---

## 🚧 缺失功能清单 (Missing Features)

### 🔴 高优先级 (High Priority)

#### 1. Reports 页面 (Reports Page)
**状态:** ❌ 完全缺失  
**优先级:** P0 - 核心功能

**需求:**
- 显示用户所有 AI 报告列表
- 支持分页（每页 10-20 条）
- 搜索功能（按策略名称、股票代码）
- 过滤功能（按日期范围、模型类型）
- 报告详情查看（Markdown 渲染）
- 报告删除功能
- 报告导出（PDF/Markdown）

**后端状态:** ✅ API 已存在 (`GET /api/v1/ai/reports`)  
**前端状态:** ❌ 页面不存在，路由显示 "Coming Soon"

**预计工作量:** 2-3 天

---

#### 2. Settings 页面 (User Settings Page)
**状态:** ❌ 完全缺失  
**优先级:** P0 - 用户体验

**需求:**
- 用户资料编辑（邮箱显示，不可编辑）
- 订阅管理（查看当前计划，到期日期）
- 配额显示（每日 AI 使用量 / 配额）
- 偏好设置（时区显示，通知设置）
- 账户删除（危险操作）
- API Token 管理（如需要）

**后端状态:** 🚧 部分 API 存在（用户信息在 Dashboard 显示）  
**前端状态:** ❌ 页面不存在

**预计工作量:** 2-3 天

---

#### 3. Strategy Lab 增强功能 (Strategy Lab Enhancements)
**状态:** 🚧 部分实现  
**优先级:** P0 - 核心差异化功能

##### 3.1 场景模拟器 (Scenario Simulator)
**需求:**
- 价格滑块（模拟股价变化，实时更新 Payoff Chart）
- 时间滑块（模拟时间流逝，Theta Decay 可视化）
- 波动率滑块（模拟 IV 变化，Vega Risk 可视化）
- 多场景对比（保存多个场景，并排对比）

**当前状态:** ❌ 未实现  
**预计工作量:** 3-4 天

##### 3.2 智能定价顾问 (Smart Price Advisor) *[Pro 功能]*
**需求:**
- 基于实时 Bid/Ask Spread 计算三个价位：
  - **保守价位** (Conservative): Bid + 0.1 * Spread
  - **激进价位** (Aggressive): Ask - 0.1 * Spread  
  - **捡漏价位** (Bargain): Mid - 0.2 * Spread
- 显示每个价位的成交概率
- 实时更新（Pro 用户 5s 刷新）

**当前状态:** ❌ 未实现  
**预计工作量:** 2-3 天

##### 3.3 交易小抄 (Cheat Sheet)
**需求:**
- 全屏模式，大字号显示
- 显示策略参数：代码、方向、限价、数量
- 移动端优化（触摸友好）
- 一键复制到剪贴板

**当前状态:** ❌ 未实现  
**预计工作量:** 1-2 天

##### 3.4 Greeks 增强显示
**当前状态:** ✅ 已有 `StrategyGreeks` 组件  
**需要增强:**
- Greeks 随时间变化的图表
- Greeks 敏感性分析（Greeks 随价格变化）
- 风险指标（Max Loss, Max Profit, Break-even 点）

**预计工作量:** 2 天

---

#### 4. Candlestick Chart 集成
**状态:** 🚧 组件存在但未使用  
**优先级:** P1 - 增强用户体验

**需求:**
- 在 Strategy Lab 中集成 K 线图
- 显示股票价格走势
- 与 Payoff Chart 联动（点击 K 线更新 Payoff）
- 技术指标（可选：MA, RSI）

**当前状态:** ✅ 组件已创建 (`CandlestickChart.tsx`)  
**预计工作量:** 2-3 天

---

#### 5. 支付成功回调页面 (Payment Success Page)
**状态:** ❌ 缺失  
**优先级:** P1 - 支付流程完整性

**需求:**
- 支付成功页面（显示订阅激活信息）
- 支付失败页面（错误处理）
- 自动跳转到 Dashboard
- 显示订阅详情

**当前状态:** 🚧 后端 Webhook 已处理，前端缺少回调页面  
**预计工作量:** 1 天

---

### 🟡 中优先级 (Medium Priority)

#### 6. Alembic 迁移完善 (Database Migrations)
**状态:** 🚧 部分完成  
**优先级:** P1 - 数据库管理

**需求:**
- 创建初始 schema 迁移（所有基础表）
- 确保迁移可回滚
- 文档化迁移流程

**当前状态:** 只有 `is_superuser` 和 `system_configs` 的迁移，基础表通过 `init_db()` 创建  
**预计工作量:** 1 天

---

#### 7. 图片导出增强 (Enhanced Image Export)
**状态:** 🚧 基础功能已实现  
**优先级:** P2 - Pro 功能差异化

**需求:**
- 4K 分辨率导出
- 品牌化选项（Pro 用户可去除水印）
- 自定义 Logo（Pro 用户可上传）
- 多种格式（PNG, SVG, PDF）
- 社交媒体优化尺寸（Twitter, Instagram）

**当前状态:** ✅ 基础导出功能存在（html2canvas）  
**预计工作量:** 2-3 天

---

#### 8. 移动端优化 (Mobile Optimization)
**状态:** 🚧 响应式设计已实现，但缺少移动端特定功能  
**优先级:** P2 - 平台差异化

**需求:**
- 全屏大字模式（交易小抄）
- 手势缩放图表
- 长按查价
- 移动端导航优化
- 触摸友好的交互

**当前状态:** ✅ 基础响应式设计存在  
**预计工作量:** 3-4 天

---

### 🟢 低优先级 (Low Priority)

#### 9. 智能筛选器 (Smart Filter)
**状态:** ❌ 未实现  
**优先级:** P3 - 未来功能

**需求:**
- 自然语言查询（如"找 IV Rank > 80 的科技股 Put"）
- 转换为 SQL/API 查询
- 保存常用筛选条件

**预计工作量:** 5-7 天（需要 NLP 处理）

---

#### 10. Google Search Grounding
**状态:** 🚧 代码结构已准备，但未启用  
**优先级:** P3 - 需要特殊 API 权限

**需求:**
- 启用 Gemini 的 Google Search Grounding
- 在每日精选生成时使用
- 结合宏观新闻分析

**当前状态:** 代码中已提及但被禁用  
**预计工作量:** 1 天（但需要 API 权限）

---

#### 11. 多 AI 模型支持 (Multi-Model Support)
**状态:** 🚧 架构已支持，但未实现切换  
**优先级:** P3 - 架构灵活性

**需求:**
- DeepSeek Provider 实现
- Qwen Provider 实现
- 管理员可切换默认模型
- 用户可选择模型（Pro 功能）

**当前状态:** ✅ `BaseAIProvider` 抽象类存在，只有 `GeminiProvider` 实现  
**预计工作量:** 3-4 天

---

#### 12. 实时数据流 (Real-time Data Stream) *[Pro]*
**状态:** 🚧 5s 缓存已实现，但非真正的流式更新  
**优先级:** P3 - 未来增强

**需求:**
- WebSocket 连接
- 实时推送市场数据更新
- 前端自动刷新图表

**当前状态:** ✅ 5s 轮询已实现（React Query `refetchInterval`）  
**预计工作量:** 5-7 天

---

## 📅 开发计划 (Development Plan)

### Phase 1: 核心功能完善 (2-3 周)

**目标:** 完成所有高优先级功能，确保核心用户体验完整

#### Week 1: 页面完善
- [ ] **Day 1-2**: Reports 页面实现
  - 列表展示，分页，搜索，过滤
  - 详情查看，删除功能
- [ ] **Day 3-4**: Settings 页面实现
  - 用户资料，订阅管理，配额显示
  - 偏好设置，账户管理
- [ ] **Day 5**: 支付成功回调页面
  - 成功/失败页面，自动跳转

#### Week 2: Strategy Lab 增强
- [ ] **Day 1-2**: 场景模拟器
  - 价格/时间/波动率滑块
  - 实时图表更新
- [ ] **Day 3**: 智能定价顾问（Pro）
  - 三个价位计算，成交概率
- [ ] **Day 4**: 交易小抄
  - 全屏模式，大字号，复制功能
- [ ] **Day 5**: Greeks 增强
  - 时间变化图表，敏感性分析

#### Week 3: 集成与优化
- [ ] **Day 1-2**: Candlestick Chart 集成
  - K 线图，与 Payoff Chart 联动
- [ ] **Day 3**: Alembic 迁移完善
  - 初始 schema 迁移
- [ ] **Day 4-5**: 测试与 Bug 修复
  - 端到端测试，性能优化

---

### Phase 2: 增强功能 (2-3 周)

**目标:** 实现中优先级功能，提升产品竞争力

#### Week 4-5: 图片导出与移动端
- [ ] 图片导出增强（4K，品牌化）
- [ ] 移动端优化（全屏模式，手势支持）

#### Week 6: 可选功能
- [ ] 多 AI 模型支持（DeepSeek, Qwen）
- [ ] Google Search Grounding（如权限可用）

---

### Phase 3: 高级功能 (未来)

**目标:** 实现智能筛选器等高级功能

- [ ] 智能筛选器（自然语言查询）
- [ ] 实时数据流（WebSocket）
- [ ] 更多技术指标
- [ ] 策略回测功能

---

## 🎯 优先级排序总结

### 立即开始 (This Week)
1. ✅ Reports 页面
2. ✅ Settings 页面
3. ✅ 支付成功回调页面

### 接下来 2 周
4. ✅ 场景模拟器
5. ✅ 智能定价顾问
6. ✅ 交易小抄
7. ✅ Candlestick Chart 集成

### 未来 1 个月
8. ✅ 图片导出增强
9. ✅ 移动端优化
10. ✅ Alembic 迁移完善

### 未来考虑
11. ⏸️ 智能筛选器
12. ⏸️ Google Search Grounding
13. ⏸️ 多 AI 模型支持

---

## 📝 技术债务 (Technical Debt)

1. **Alembic 迁移**: 需要创建初始 schema 迁移
2. **错误处理**: 部分错误处理可以更优雅
3. **测试覆盖**: 缺少单元测试和集成测试
4. **文档**: API 文档可以更详细
5. **性能优化**: 大数据量时的查询优化

---

## 🔍 代码质量改进

1. **TypeScript 严格模式**: 消除所有 `any` 类型
2. **错误边界**: 添加更多 React Error Boundaries
3. **加载状态**: 统一加载状态 UI
4. **无障碍性**: 改进 ARIA 标签和键盘导航
5. **国际化准备**: 虽然当前只有英文，但架构应支持 i18n

---

## 📊 完成度评估

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 认证系统 | 100% | ✅ 完成 |
| 市场数据 | 95% | ✅ 完成（缺少实时流） |
| AI 服务 | 90% | ✅ 完成（缺少 Google Search） |
| 支付系统 | 100% | ✅ 完成 |
| 策略管理 | 85% | 🚧 核心完成，缺少高级功能 |
| 管理员系统 | 100% | ✅ 完成 |
| Reports 页面 | 0% | ❌ 未开始 |
| Settings 页面 | 0% | ❌ 未开始 |
| Strategy Lab | 70% | 🚧 核心完成，缺少增强功能 |
| 移动端优化 | 40% | 🚧 基础响应式，缺少特定功能 |

**总体完成度:** ~75%

---

## 🚀 下一步行动

1. **立即开始**: Reports 页面开发
2. **并行进行**: Settings 页面开发
3. **准备**: 收集 Strategy Lab 增强功能的具体需求
4. **测试**: 端到端测试现有功能

---

**最后更新:** 2025-01-XX  
**维护者:** ThetaMind Development Team

